$(function(){function e(e){m.css("opacity","0.5"),e.css("opacity","1")}function t(){m.css("opacity","1")}function a(e){return void 0!=e.attr("disabled")}function o(){var t=$(this);a(t)||e(t)}function n(){var e=$(this);e.attr("id");a(e)||t()}function i(e){var t=$("#"+e+"-panel");0!=t.length&&($(".lower-section").hide(),$(".result-btn-panel").hide(),$(document).trigger("beforeResultsPanelShow",{id:e}),t.show(),$("#buttonPanelsNav").show())}function r(){Sejda.LocalStorage.setItem("tasks.success.counter",s()+1)}function s(){return parseInt(Sejda.LocalStorage.getItem("tasks.success.counter")||"0")}function l(){var e=Sejda.LocalStorage.getItem("feedback.saveTime.asked");"yes"!==e&&Sejda.Utils.isProUser()&&(s()<5||(Sejda.LocalStorage.setItem("feedback.saveTime.asked","yes"),g.show(),k.focus()))}function c(e,t){var a=window.location.protocol+"//"+t.resultFullUrlPattern;return a.replaceAllEscaped(encodeURIComponent("{{filename}}"),encodeURIComponent(e))}function d(e,t){return c(e,t).replaceAllEscaped("d=true","v=true")}function u(){parent.closeResultsFrame(S)}function f(){var e=window.top.location.protocol+"//"+window.top.location.hostname+window.top.location.pathname;w?window.top.location.href=e:history.back()}function p(){setTimeout(function(){u()},72e5)}var m=$(".result-btn");m.hover(o,n),m.click(function(){var e=$(this),t=e.attr("id");i(t)}),$("#backToAllActionsBtn").click(function(){$(".lower-section").show(),$(".buttons-section").show(),$(".result-btn-panel").hide(),$("#buttonPanelsNav").hide()});var w=window!=window.top,v=!1,h=$("#shareByEmailForm");window.cancelTask=function(){parent.cancelTask(b)};var g=$("#results-feedback-section"),k=$("#results-feedback-textarea");$(document).on("click","#results-feedback-section .close",function(){g.hide()}),$(document).on("click","#download-btn",function(){setTimeout(function(){l()},500)}),$(document).on("click","#submitResultsFeedback",function(){$(this).remove();var e=k.val().trim(),t=e.length>7,a=e.trim().split(" ").length>=2;if(!t||!a)return void g.fadeOut(2e3);var o={source:window.location.href,source2:window.top.location.href,message:"Feedback: "+e,suflet:"realitate",email:$("#contact-email").val()};try{if(window.top.Analytics){var n=window.top.Analytics.events();o.events=JSON.stringify(n,null,1)}}catch(e){}$.ajax({url:"/contact",method:"POST",data:o}).always(function(){g.find("h1").text("Sent, thank you!"),g.fadeOut(1e3)})});var b=getQueryParameterByName("id"),y=function(){var e=$(".loading, .queued, .processing, .completed, .failed, .expired");$.get("/api/tasks/"+b+"/change",function(t){function a(){try{if(window.___gcfg)return;$("#gdrive-save-preload-btn").hide(),$(".g-savetodrive-wrapper").show(),isIe()?($("#gdrive-save-btn").click(function(e){return e.preventDefault(),alert("Sorry, saving to GDrive is not supported in Internet Explorer."),!1}),$(".g-savetodrive-wrapper").remove()):(window.___gcfg={parsetags:"explicit"},$("#gdrive-save-btn-real").attr("data-src",l).attr("data-filename",$("#download-btn").attr("download")),GoogleApis.load(function(){try{gapi.savetodrive.render("gdrive-save-btn-real",{src:l,filename:$("#download-btn").attr("download"),sitename:"Sejda PDF"})}catch(e){}}))}catch(e){}}var o=t.status.toLowerCase();if(e.not("."+o).hide(),$("."+o).show(),"processing"===o||"queued"===o)setTimeout(function(){y()},3e3);else if("completed"===o){window.parent.$(window.parent.document).trigger("taskProcessingCompleted"),window.cancelTask=function(){};try{r()}catch(e){}if(w&&($(".more-actions .new-task-btn").show(),$("#back-btn-task-ok").hide()),t.upgrade){var n=t.upgrade.reason;$("#"+n+"-reason").show(),$("#resultsLockedTitle").show(),$(".upgrade-section").show(),$(".download-btn-group-wrap").remove(),$(".back-btn").show(),$(".social-list").hide(),$(".get-support-btn").hide(),$(".more-actions .new-task-btn").hide(),window.top.Analytics.trackEvent("paywall",n),$.cookie("upgradeReason",n,{path:"/"}),$.removeCookie("upgradeReturnUrl",{path:"/"}),Sejda.LastTasks.setLastTaskUrl(window.top.location.href);var s=$(window.top.document).find("#task-content").attr("data-task");$.cookie("upgradeRefTask",s,{path:"/"})}else{var l=c(t.resultFilename,t),f=$("#download-btn");f.attr("href",l).attr("download",t.resultFilename),$(".result-filename .filename").text(t.resultFilename.truncateMiddle(55)).attr("title",t.resultFilename),f.click(function(){$("#startNewBtn").fadeIn(300)});var m=f.attr("href"),v=t.resultFilename.toLowerCase();if(v.endsWith(".zip")){var g=$(".completed h1");g.find(".singular").hide(),g.find(".plural").show()}$(".continue-with-nav a,a.continue-with-btn").click(function(e){e.preventDefault();var a=$(this).attr("href"),o=t.resultItems.map(function(e){return{downloadUrl:c(e,t),originalFilename:e,title:e,workflow:"continue-with"}});Sejda.SessionStorage.setItem("files",JSON.stringify(o)),window.top.location.href=a}),$(document).on("click","#rename-btn",function(e){var a=f.attr("download"),o=a.lastIndexOf("."),n=a.substring(o+1),i=a.substring(0,o),r=prompt("New filename:",i);if(null!=r){r=r.replace(/[\/\\]/g,"");var s=r+"."+n,l=c(s,t);f.attr("href",l);var d=$(".result-filename .filename");d.text(s).attr("title",s),f.attr("download",s);var u=$(".g-savetodrive-wrapper");u.find("div").remove();var p=$('<div id="gdrive-save-btn-real" class="g-savetodrive"></div>');p.attr("data-src",f.attr("href")).attr("data-filename",s).attr("data-sitename","Sejda PDF"),u.append(p);try{window.___gcfg&&gapi.savetodrive.go("container")}catch(e){}k&&(document.getElementById("download-btn").click(),k=!1)}});var k=!1;$(document).on("click","#save-as-btn",function(e){k=!0,document.getElementById("rename-btn").click()}),$("#result-container").click(function(e){$(e.target).parents("#download-dropdown").length>0||$("#download-dropdown").removeClass("open")});var b=$("#print-btn"),F=t.resultFilename.toLowerCase().endsWith(".pdf");if(F?b.click(function(e){window.open("/print?url="+encodeURIComponent(m))}):b.hide(),F){var B=$("#preview-pdf"),j=$("#open-preview-btn"),E=$("#close-preview-btn");j.click(function(){B.find("iframe").remove(),B.append($('<iframe rel="nofollow noopener"></iframe>').attr("src",d(t.resultFilename,t))),B.show(),j.hide(),E.show(),Sejda.LocalStorage.setItem("results.autoShowPreview","true")}),E.click(function(){Sejda.LocalStorage.setItem("results.autoShowPreview","false"),B.hide(),j.show(),E.hide()});var x=!0;"false"===Sejda.LocalStorage.getItem("results.autoShowPreview")&&(x=!1),(Sejda.Browsers.isMobile||Sejda.Browsers.isIe||Sejda.Browsers.isFirefox||Sejda.Browsers.isSlowNetwork)&&(x=!1,$(".lower-section").remove()),x&&j.click()}else $(".lower-section").remove();var I=$("#download-dropdown");I.find(".dropdown-toggle").on("click",function(e){I.toggleClass("open"),Sejda.OptOutChoices.noGoogle()?$("#gdrive-save-preload-btn").click(function(){Sejda.OptOutChoices.askGoogle().then(function(){a()})}):a()});var D=getQueryParameterByName("returnEmail");D&&(D=D.split(",")[0].trim(),"fillSign"===t.type?(i("request-complete-btn"),$("#completeReqByEmailForm").find("[name=emailTo]").val(D),$("#request-complete-btn-panel").find(".return-email").text(D),$(".buttons-section").hide(),$(".lower-section").show()):(h.find("[name=emailTo]").val(D),h.find("[name=isReturnEmailFeature]").val("yes"),i("share-btn"),$(".buttons-section").hide(),$(".lower-section").show()))}if(t.warnings&&t.warnings.length>0){var C=_.map(t.warnings,function(e){return"<p>"+e+"</p>"}).join("");$("#result-warnings").html(C),$("#result-warnings-wrap").show()}p()}else if("failed"===o){if(t.failureReason?$("#failureReason").text(t.failureReason):$("#taskFailedTaskAccess").show(),window.top.Analytics.trackNoPushEvent("taskFailed",t.failureReason),$(".social-list").hide(),t.upgrade){var n=t.upgrade.reason;"timeout"===n&&$("#"+n+"-reason").show()}if("File not found. Please reupload and try again."===t.failureReason)return $("#failureReason").text("Session expired, file not found. Please reupload and try again."),$("#failureSubReason").text("We don't store your documents permanently, they are automatically deleted when session expires.").show(),$(".get-support-btn").hide(),void(w&&window.parent.sessionExpiredFromResultsFrame(function(e){e?S=!0:u()}));if(w&&"Could not crop automatically"===t.failureReason)try{window.parent.couldNotCropAutomaticallyFromResultsFrame(function(){u()})}catch(e){}}t.remark&&$("h2.remark").text(t.remark).show()}).fail(function(t){404==t.status?(e.not(".expired").hide(),$(".expired").show(),$(".social-list").hide(),$(".get-support-btn").hide()):setTimeout(function(){y()},1e4)})};y(),$(document).on("click","#dropbox-save-btn",function(e){e.preventDefault();var t=$(this);if(!t.attr("disabled")){var a=$("#download-btn"),o={files:[{url:a.attr("href"),filename:a.attr("download")}],success:function(){v=!0,t.removeClass("spinning"),alert("File saved to your Dropbox.")},progress:function(e){},cancel:function(){t.removeClass("spinning"),alert("Save cancelled.")},error:function(e){t.removeClass("spinning"),alert("Save failed."),window.top.Analytics.trackEvent("dropboxSaveFailed")}};Sejda.OptOutChoices.askDropbox().then(function(){DropboxApis.loadDropins(function(){"undefined"!=typeof Dropbox?(Dropbox.save(o),window.top.Analytics.trackEvent("dropboxSave"),t.addClass("spinning")):alert("We couldn't connect to Dropbox.com. Your browser (or add-ons) might be blocking the load of javascript files from Dropbox.")})})}}),$(document).on("click","#onedrive-save-btn",function(e){e.preventDefault();var t=$(this);if(!t.attr("disabled")){var a=$("#download-btn"),o={clientId:"53034c10-3b68-49ac-88fe-723b519e2d1c",action:"save",sourceUri:a.attr("href"),fileName:a.attr("download"),openInNewWindow:!0,nameConflictBehavior:"",advanced:{redirectUri:[window.location.protocol,"//",window.location.host,"/one-drive-auth"].join("")},success:function(){v=!0,t.removeClass("spinning"),alert("File saved to your OneDrive.")},progress:function(e){},cancel:function(){t.removeClass("spinning"),alert("Save cancelled.")},error:function(){t.removeClass("spinning"),alert("Save failed."),window.top.Analytics.trackEvent("oneDriveSaveFailed")}};Sejda.OptOutChoices.askMicrosoft().then(function(){OneDriveApis.loadApi(function(){"undefined"!=typeof OneDrive?(OneDrive.save(o),window.top.Analytics.trackEvent("oneDriveSave"),t.addClass("spinning")):alert("We couldn't connect to OneDrive. Your browser (or add-ons) might be blocking the load of javascript files from OneDrive.")})})}});var S=!1;$(document).on("click",".delete-task-btn",function(e){e.preventDefault(),$.ajax({url:"/api/tasks/"+b,type:"DELETE",success:function(){f()},data:{},contentType:"application/json",dataType:"json"}).fail(function(e){404==e.status?f():alert("An error occurred. Please try again.")})}),$(".close-frame-btn").click(function(e){e.preventDefault(),u()}),w&&($("#closeFrame").show().click(function(e){e.preventDefault();try{window.cancelTask()}catch(e){}u()}),$(".back-btn").off("click").on("click",function(e){e.preventDefault(),u()}),$(".new-task-btn").click(function(){var e=window.top.location.protocol+"//"+window.top.location.hostname+window.top.location.pathname;window.top.location.href=e})),$(".result-btn,#download-btn,.filename-btn").tooltip(tooltipOpts),$("#download-btn").click(function(){v=!0}),$(".already-customer-link.login-btn").click(function(e){return e.preventDefault(),window.top.showLoginModal(),!1}),$(document).on("beforeResultsPanelShow",function(e,t){switch(t.id){case"share-btn":const a=Sejda.Utils.getIpCountry(),o=Sejda.Utils.isProUser(),n="yes"===h.find("[name=isReturnEmailFeature]").val();n||o||"IN"!==a&&"BD"!==a&&"PK"!==a||(h.find(".share-email-step").hide(),h.find(".only-pro").show(),$('[role=tab][href="#byLink"]').click())}})}),$(function(){(function(){function e(e){$(".share-link-step").hide(),$("#shareLinkStep"+e).show()}var t=$("#shareFileLinkTextarea");$("#shareFileGenerateBtn").click(function(){var a=getQueryParameterByName("id");e(2);var o={filename:$("#download-btn").attr("download")};$.jsonPost("/api/tasks/"+a+"/share/link",o).done(function(a){var o="https://"+window.location.hostname+a.url;t.val(o),e(3)}).fail(function(t){var a="Could not get shareable link. Please try again later";400==t.status?a=t.responseText:429==t.status&&(a="Too many requests, please try again later."),showAlert(a),e(1)})})})(),function(){function e(e){$(".share-email-step").hide(),$("#shareEmailStep"+e).show()}var t=$("#emailVerificationCode"),a=$("#shareByEmailForm");a.submit(function(a){a.preventDefault();var o=getQueryParameterByName("id");e(2);var n=$(this).serializeJSON({parseAll:!0});return Sejda.LocalStorage.setItem("shareByEmailFrom",n.emailFrom),Sejda.LocalStorage.setItem("shareByEmailTo",n.emailTo),n.filename=$("#download-btn").attr("download"),$.jsonPost("/api/tasks/"+o+"/share/email",n).done(function(){Sejda.LocalStorage.setItem("shareByEmailVerificationCode",n.emailVerificationCode),e(3)}).fail(function(a){var o="Error sending email. Please try again later";if(400==a.status)o=a.responseText;else if(429==a.status)o="Sending limit reached. Please try again later";else if(403==a.status)return e(4),t.val(""),void $(".verify_email_address").text(n.emailFrom);showAlert(o),e(1)}),!1});const o=$("body").attr("data-logged-in-user");var n=Sejda.LocalStorage.getItem("shareByEmailFrom")||o;n&&$("#shareByEmailFrom").val(n);var i=Sejda.LocalStorage.getItem("shareByEmailTo");i&&$("#shareByEmailTo").val(i);var r=Sejda.LocalStorage.getItem("shareByEmailVerificationCode");r&&t.val(r),$("#shareByEmailAgainBtn").click(function(){e(1)})}(),function(){var e=getQueryParameterByName("id");$("#allowAccessTaskDataBtn").click(function(){Analytics.trackNoPushEvent("troubleshooting","allow",e),$("#taskFailedTaskAccess").html("<p>Thank you</p>").hideAfter(3e3),$.post("/api/tasks/"+e+"/allow")})}(),function(){function e(e){$(".complete-req-by-email-step").hide(),$("#completeReqByEmailStep"+e).show()}var t=Sejda.LocalStorage.getItem("completeReqByEmailFrom");t&&$("#completeReqByEmailSignerEmail").val(t);var a=$("#completeReqByEmailVerificationCode"),o=Sejda.LocalStorage.getItem("completeReqByEmailVerificationCode");o&&a.val(o),$("#completeReqByEmailDownloadCopyBtn").click(function(){document.getElementById("download-btn").click()}),$("#completeReqByEmailForm").submit(function(t){t.preventDefault();var o=getQueryParameterByName("id");e(2);var n=$(this).serializeJSON({parseAll:!0});return Sejda.LocalStorage.setItem("completeReqByEmailFrom",n.emailFrom),n.filename=$("#download-btn").attr("download"),$.jsonPost("/api/tasks/"+o+"/request/completed",n).done(function(){e(3)}).fail(function(t){var o="An error occurred. Please try again later or contact support";if(400==t.status)o=t.responseText;else if(403==t.status)return e(4),a.val(""),void $(".verify_email_address").text(n.emailFrom);showAlert(o),e(1)}),!1})}()}),$(function(){const e=Sejda.Utils.getIpCountry(),t=Sejda.Utils.isProUser(),a="IN"===e||"BD"===e||"ID"===e,o=window.noSupportButton||window.parent.noSupportButton;t||!a&&!o||$(".get-support-btn").remove()}),$(function(){var e=$.extend({},tooltipOpts,{placement:"left",trigger:"focus"});$("[name=emailFrom]").tooltip(e),$("[name=emailTo],[name=emailFrom]").on("blur",function(){$(this).mailcheck({suggested:function(e,t){var a=$(e),o=a.siblings(".mailcheck_suggest");"readonly"!=a.attr("readonly")&&(o.find("a").text(t.full).off("click").on("click",function(){o.hide(),a.val(t.full)}),o.show())},empty:function(e){$(e).siblings(".mailcheck_suggest").hide()}})}),window.top.noSupportButton===!0&&$(".get-support-btn").hide()}),$(function(){$('[data-toggle="tooltip"]').tooltip()});